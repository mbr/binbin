#!/usr/bin/python

# argparse, because we don't want external dependenceis

import argparse
import subprocess
import sys

parser = argparse.ArgumentParser()
parser.add_argument('-f', '--file', dest='files', action='append',
                    help='file to watch')
parser.add_argument('cmd', nargs='*')

args = parser.parse_args()

# by default, watch current directory
if not args.files:
    args.files = ['.']

while True:
    # run command
    p = subprocess.Popen(args.cmd)
    p.wait()

    # watch for changes
    print 'Waiting for changes...'
    p = subprocess.Popen([
        'inotifywait',
        '--quiet',
        '--recursive',
        '--event', 'modify,create,delete,move',
    ] + args.files)
    p.wait()
